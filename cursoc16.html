<HTML><!-- InstanceBegin template="/Templates/plantilla.dwt" codeOutsideHTMLIsLocked="false" -->

<HEAD>
  <!-- InstanceBeginEditable name="doctitle" -->
  <TITLE>Curso de C - Asignacion dinamica de memoria</TITLE>
  <!-- InstanceEndEditable -->
  <meta name="decription" content="Curso de C - Introducci�n">
  <meta name="keywords" content="Programaci&oacute;n, Curso de C, C">
  <META NAME="GENERATOR" CONTENT="Arachnophilia 3.5">
  <META NAME="FORMATTER" CONTENT="Arachnophilia 3.5">
  <meta name="author" content="Gorka Urrutia">
  <meta name="DC.Creator" content="Gorka Urrutia">
  <META name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="cursoc.css">
  <!-- InstanceBeginEditable name="head" -->


  <!-- InstanceEndEditable -->
</HEAD>

<BODY>
  <a name="arriba"></a>

  <table width="100%" border="0">
    <tr>
      <td align="left"><img src="cursoc.gif" alt="Curso de C" border="0">
      </td>
      <td align="right"><a href="http://www.elrincondelc.com" target="_top"><img src="colibri.gif"
            alt="El Rinc�n del C - www.elrincondelc.com" border="0"></a>
      </td>
    </tr>
  </table>
  <!-- InstanceBeginEditable name="Titulo" -->
  <h1>Asignación dinámica de memoria</h1><!-- InstanceEndEditable -->


  <p class="barranavegaciontop"><!-- InstanceBeginEditable name="BarraNavegacion" -->
    <a href="cursoc15.html">[Anterior]</a> <a href="cursoc17.html">[Siguiente]</a>
    <a href="index.html" target="_top">[Contenido]</a>
    <!-- InstanceEndEditable -->
  </p>

  <!-- InstanceBeginEditable name="Cuerpo" -->

  <A NAME="contenido"></A>
  <H2>
    Contenido
  </H2>

  <UL>
    <LI><A HREF="#quees" CLASS="enlace">¿Qué es la asignación dinámica?</A>
    <LI><A HREF="#malloc" CLASS="enlace">Malloc y free</A>
    <LI><A HREF="#ejercicios" CLASS="enlace">Ejercicios</A>
  </UL>


  <A NAME="quees"></A>
  <H2>
    ¿Qué es la asignación dinámica?
  </H2>

  <p>Hasta ahora hemos visto que cada vez que queremos usar una variable debemos reservarle un lugar de la memoria al
    comenzar el programa. Debemos indicar cuénta memoria vamos a usar. Pero hay ocasiones en que esto no es bueno, hay
    veces en las que no sabemos cuénta memoria vamos a necesitar. Por ejemplo si hacemos un editor de texto no podemos
    saber de antemano cuál va a ser la longitud del texto.</p>

  <p>Por eso a veces es necesario poder reservar memoria según se va necesitando. Además de esta forma nuestros
    programas aprovecharán mejor la memoria del ordenador en el que se ejecuten, usando sólo lo necesario.</p>

  <p>La asignación de memoria es la base de lo que veremos en capítulos posteriores, especialmente los capítulos de
    listas enlazadas. En estos capítulos es donde se verá la verdadera utilidad de la asignación dinámica.</p>

  <p class="volver"><a href="#arriba">[Arriba]</a></p>

  <A NAME="malloc"></A>
  <H2>
    Malloc y free
  </H2>

  <p>Existen varias funciones para la asignación dinámica de la memoria, pero las dos funciones básicas son
    <em>malloc</em> y <em>free</em>.
  </p>

  <p>La función malloc (<B>M</B>emory <B>alloc</B>ate - asignar memoria) reservar una parte de la memoria y devuelve la
    dirección del comienzo de esa parte. Esta dirección podemos almacenarla en un puntero y así podemos acceder a la
    memoria reservada. La función malloc tiene el siguiente formato:</p>

  <DIV CLASS="ejemplo">
    <PRE>
<var>puntero</var> = (<em>tipo_de_variable</em> *) <B>malloc(</B> <em>número de bytes a reservar</em> <B>);</B>
</PRE>
  </DIV>

  <ul class="texto">
    <li><var>puntero</var>: es una variable tipo puntero que almacena la dirección del bloque de memoria reservado.
      Puede ser un puntero a char, int, float,...
    <li>(<em>tipo_de_variable</em> *): es lo que se llama un <em>molde</em>. La función malloc nos reserva una cierta
      cantidad de bytes y devuelve un puntero del tipo <b>void</b> (que es uno genérico). Con el molde le indicamos al
      compilador que lo convierta en un puntero del mismo tipo que la variable <var>puntero</var>. Esto no es necesario
      en C, ya que lo hace automáticamente, aunque es aconsejable acostumbrarse a usarlo.
  </ul>

  <p>Una vez reservada la memoria y guardada su dirección en un puntero podemos usar ese puntero como hemos visto hasta
    ahora.</p>

  <p>Si no había suficiente memoria libre malloc devolvera el valor NULL. El puntero por tanto apuntara a NULL. Es muy
    importante comprobar siempre si se ha podido reservar memoria o no comprobando el valor de <var>puntero</var>:</p>

  <DIV CLASS="ejemplo">
    <PRE>
if (puntero)
</PRE>
  </DIV>

  <p>se cumple si hay memoria suficiente, en caso contrario el falso.</p>

  <p>Cuando ya no necesitemos más el espacio reservado debemos liberarlo, es decir, indicar al ordenador que puede
    destinarlo a otros fines. Si no liberamos el espacio que ya no necesitamos corremos el peligro de agotar la memoria
    del ordenador. Para ello usamos la función <em>free</em>, que funciona de la siguiente manera:</p>

  <DIV CLASS="ejemplo">
    <PRE>
<B>free(</B> <em>puntero</em> <B>);</B>
</PRE>
  </DIV>

  <p>Donde <var>puntero</var> es un puntero que apunta al comienzo del bloque que habíamos reservado. Es muy importante
    no perder la dirección del comienzo del bloque, pues de otra forma no podremos liberarlo.</p>

  <p>Vamos a ver un sencillo ejemplo del manejo de <code>malloc</code> y <code>free</code>:</p>

  <DIV CLASS="ejemplo">
    <PRE>
#include &lt;stdio.h&gt;

int main()
    {
    int bytes;
    char *texto;

    printf("Cuantos bytes quieres reservar: ");
    scanf("%i",&bytes);
    texto = (char *) malloc(bytes);
    <FONT COLOR=#0000ff>/* Comprobamos si ha tenido éxito la operación */</FONT>
    if (texto)
       {
       printf("Memoria reservada: %i bytes = %i kbytes = %i Mbytes\n",
              bytes, bytes/1024, bytes/(1024*1024));
       printf("El bloque comienza en la dirección: %p\n", texto);
       /* Ahora liberamos la memoria */
       free( texto );
       }
    else
        printf("No se ha podido reservar memoria\n");
    }
</PRE>
    <DIV CLASS="comprobado">Comprobado con DJGPP</DIV>
  </DIV>

  <p>En este ejemplo se pregunta cuénta memoria se quiere reservar, si se consigue se indica cuénta memoria se ha
    reservado y dónde comienza el bloque. Si no se consigue se indica meniante el mensaje: "No se ha podido reservar
    memoria".</p>

  <p>Probemos este ejemplo reservando 1000 bytes:</p>

  <DIV CLASS="ejemplo">
    <PRE>
Cuantos bytes quieres reservar: <B>1000</B>
Memoria reservada: 1000 bytes = 0 kbytes = 0 Mbytes
El bloque comienza en la dirección: 90868
</PRE>
  </DIV>

  <p>Pru�balo unas cuantas veces incrementando el tamaño de la memoria que quieres reservar. Si tienes 32Mbytes de
    memoria RAM teclea lo siguiente:</p>

  <DIV CLASS="ejemplo">
    <PRE>
Cuantos bytes quieres reservar: <B>32000000</B>
No se ha podido reservar memoria
</PRE>
  </DIV>

  <p>Malloc no ha podido reservar tanta memoria y devuelve (null) por lo que se nos avisa de que la operación no se ha
    podido realizar.</p>

  <p class="volver"><a href="#arriba">[Arriba]</a></p>

  <A NAME="ejercicios"></A>
  <H2>
    Ejercicios
  </H2>

  <P><B><U>Ejercicio :</U></B>
  </P>


  <P><B>Solución</B>:
  </P>

  <p class="volver"><a href="#arriba">[Arriba]</a></p>

  <!-- InstanceEndEditable -->
  <p class="barranavegacionabajo"><!-- InstanceBeginEditable name="PieNavegacion" -->
    <a href="cursoc15.html">[Anterior]</a> <a href="cursoc17.html">[Siguiente]</a>
    <a href="index.html" target="_top">[Contenido]</a>
    <A HREF="mailto:cursoc@elrincondelc.com" class="nombre">
      -----------------------------------------------------------------------------------------------------------------
      ISC.
      Jose Nicolas Jimenez Hernandez</A>
    <!-- InstanceEndEditable -->
  </p>
</BODY>

<!-- InstanceEnd -->

</HTML>